<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Participante ‚Äî Sorteio</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="fw" class="fw" aria-hidden="true"></canvas>
<div class="card">
  <div class="logo">Fam√≠lia Oliveira</div>
  <h2>Sorteio de Pratos 2025</h2>

  <label>Senha de acesso (fornecida)</label>
  <input id="access" placeholder="Senha de acesso (ex: Oliveira2025)" autocomplete="off"/>

  <label>Seu nome</label>
  <input id="nome" placeholder="Ex.: Maria Silva" autocomplete="name"/>

  <label>Crie uma senha pessoal</label>
  <input id="userpwd" type="password" placeholder="Senha s√≥ sua" autocomplete="new-password"/>

  <button id="btnDraw" class="bigbtn">Sortear (apenas 1 vez)</button>
  <button id="btnCheck" class="bigbtn outline">Consultar resultado</button>

  <p id="resultado" class="resultado" aria-live="polite"></p>
  <p class="small">Funciona localmente (cada aparelho) ou com Firebase (para atualiza√ß√£o central). Se quiser sincronizar entre aparelhos, eu te ajudo a ativar o Firebase.</p>
</div>

<script>
// ITEMS_DEFAULT placeholder will be replaced
const ITEMS_DEFAULT = ["Arroz (Janta 31/12)", "Arroz (Almo√ßo 01/01)", "Feij√£o tropeiro (Janta 31/12)", "Feijoada (Almo√ßo 01/01)", "Vinagrete e salada (Almo√ßo 01/01)", "Vinagrete e salada (Janta 31/12)", "Escondidinho √† gosto - 15 po√ß√µes (Janta 31/12)", "Salpic√£o √† gosto - 15 por√ß√µes (Janta 31/12)", "Lasanha √† gosto - 15 por√ß√µes (Almo√ßo 01/01)", "Strogonoff - 15 por√ß√µes (Almo√ßo 01/01)", "Pudim - 15 por√ß√µes (p√≥s janta 31/12)", "Bombom na travessa - 15 por√ß√µes (p√≥s janta 31/12)", "Pav√™ - 15 por√ß√µes (p√≥s almo√ßo 01/01)", "Mousse de maracuj√°- 15 por√ß√µes (p√≥s almo√ßo 01/01)", "P√£o (contribui√ß√£o em dinheiro 20,00)", "1 Caf√© p√≥ (servido pt manh√£)", "1 Caf√© p√≥ (servido pt tarde)", "1L Leite (servido parte manh√£)", "1L Leite (servido parte tarde)", "1 Margarina 250g", "1k Queijo", "15un Chimango (caf√© da manh√£)", "15un P√£o de queijo (caf√© da tarde)", "1 Bolo simples de padaria (caf√© da manh√£)", "1 Bolo simples de padaria (caf√© da tarde)", "1L Suco (caf√© da manh√£)", "1L Suco (caf√© da tarde)", "Chocolate em p√≥", "Bolo de tapioca - 15 por√ß√µes (caf√© da manh√£)", "Cuscuz- 10 por√ß√µes (caf√© da manh√£)", "Salada de frutas - 15 por√ß√µes (caf√© da tarde)", "A - Champanhe/ espumante sem √°lcool", "B - Champanhe/ espumante sem √°lcool"];

// fireworks (simple)
(function(){const c=document.getElementById('fw'); if(!c) return; const ctx=c.getContext('2d'); function resize(){c.width=innerWidth; c.height=innerHeight;} resize(); window.addEventListener('resize', resize); function boom(){const x=Math.random()*c.width,y=Math.random()*c.height*0.5; for(let i=0;i<18;i++){ setTimeout(function(){ ctx.beginPath(); ctx.arc(x+Math.cos(i*2*Math.PI/18)*(30+Math.random()*60), y+Math.sin(i*2*Math.PI/18)*(30+Math.random()*60), 3+Math.random()*3,0,Math.PI*2); ctx.fillStyle=['rgba(212,175,55,0.95)','rgba(255,140,0,0.9)','rgba(255,105,180,0.85)'][Math.floor(Math.random()*3)]; ctx.fill(); }, i*25);} } setInterval(boom,900); })();

// local storage helpers
function loadItems(){ return JSON.parse(localStorage.getItem('itens_restantes')||'null') || ITEMS_DEFAULT.slice(); }
function saveItems(arr){ localStorage.setItem('itens_restantes', JSON.stringify(arr)); }
function loadParticipants(){ return JSON.parse(localStorage.getItem('participants')||'[]'); }
function saveParticipants(p){ localStorage.setItem('participants', JSON.stringify(p)); }

function show(msg){ document.getElementById('resultado').innerText = msg; }

// draw logic: one draw per nome+senha (client-side)
document.getElementById('btnDraw').addEventListener('click', function(){ 
  var access = document.getElementById('access').value.trim();
  var nome = document.getElementById('nome').value.trim();
  var userpwd = document.getElementById('userpwd').value.trim();
  if(!access||!nome||!userpwd){ show('Preencha todos os campos.'); return; }

  // local-only mode
  var partes = loadParticipants();
  var found = partes.find(function(p){ return p.nome===nome && p.senha===userpwd; });
  if(found){ show('Voc√™ j√° sorteou: ' + found.item); return; }
  var itens = loadItems();
  if(itens.length===0){ show('Nenhum item restante.'); return; }
  var idx = Math.floor(Math.random()*itens.length);
  var chosen = itens.splice(idx,1)[0];
  partes.push({nome:nome, senha:userpwd, item:chosen, ts:new Date().toISOString()});
  saveParticipants(partes);
  saveItems(itens);
  show('üéâ '+nome+', seu prato: '+chosen + ' (registro salvo localmente).');
});

document.getElementById('btnCheck').addEventListener('click', function(){ 
  var nome = document.getElementById('nome').value.trim();
  var userpwd = document.getElementById('userpwd').value.trim();
  if(!nome||!userpwd){ show('Preencha nome e senha para consultar.'); return; }
  var partes = loadParticipants();
  var found = partes.find(function(p){ return p.nome===nome && p.senha===userpwd; });
  if(found) show('Seu prato: '+found.item);
  else show('Nenhum resultado local. Se sortearam em outro aparelho, pe√ßa √† organizadora para consultar o painel.');
});
</script>
</body>
</html>
